/*
 Miracle 1.0.0, 04.04.14 02:06
 © 2014, Maxim Dubrovin,  License — https://github.com/MaximDubrovin/miracle/blob/dev/LICENSE-MIT.md 
*/
M={},M.settings={miracleClass:".miracle",miraclesDefaultStyle:".miracle { opacity: 0; }",spinnerFadeTimeout:111,effectDuration:500,easing:{"default":"ease-in-out","ease-y":"ease-out","ease-x":"ease-out"},spinnerOpts:{lines:9,length:6,width:2,radius:6,corners:1,rotate:0,direction:1,color:"#000",speed:1.6,trail:72,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"}},M.vars={miracleStyleElem:void 0},M.init=function(){var a=$(M.settings.miracleClass);a.length&&(M.createStyleElem(),a.each(function(){{var a,b={};$(this)}b.$=$(this),b.name=M.getUniqueName(),b.imgsLoadedCounter=0,b.spinner={},b.inherit=b.$.data("m-inherit"),b.props=M.getProps.init(b),b.effect=b.props.mEffect,b.style={init:b.props.mStyleInit,"final":b.props.mStyleFinal},b.easing=b.props.mEasing,b.opaque=b.props.mOpaque,b.scaleInit=b.props.mScaleInit,b.origin=b.props.mOrigin,b.translate=b.props.mTranslate,b.duration=b.props.mDuration,b.awaitLoad=b.props.mAwaitLoad,b.awaitShow=b.props.mAwaitShow,b.timeout=b.props.mTimeout,b.spinner.use=b.props.mSpinner,M.defineSelectors(b),a=M.findImgs.init(b),a.length?M.bindImgs(b,a):(b.$.data("m-loaded",!0),M.showMiracle.prepare(b))}))},M.getProps={init:function(a){var b,c,d,e;return a.inherit?(c=M.getProps.inherit(a),d=M.getProps.self(a),e=$.extend({},c,d),b=e):(d=M.getProps.self(a),b=d),b},inherit:function(a){var b,c,d;return"prev"==a.inherit?(b=a.$.prev(".miracle"),b&&(c=b.data())):(d="[data-m-id='"+a.inherit+"']",b=$(d),b.length&&(c=b.data())),c},self:function(a){return a.$.data()}},M.findImgs={init:function(a){var b,c,d;if(a.$.is("img"))b=a.$;else if(c=M.findImgs.imgElems(a),d=M.findImgs.bgImgs(a),b=c,d.length)for(var e=0,f=d.length;f>e;e++)b=b.add(d[e]);return b},imgElems:function(a){return a.$.find("img")},bgImgs:function(a){var b=[],c=a.$.find("*").add(a.$);return c.each(function(){var a,c,d=$(this),e=M.parseBgImgUrls(d);if(e.length)for(var f=0,g=e.length;g>f;f++)a=e[f],c=$("<img/>").attr("src",a),b.push(c)}),b}},M.bindImgs=function(a,b){b.on("load",function(){a.imgsLoadedCounter++,a.imgsLoadedCounter>=b.length&&(a.$.data("m-loaded",!0),M.showMiracle.prepare(a))})},M.showMiracle={prepare:function(a){M.spinner.show(a),a.awaitShow?M.showMiracle.await.show(a):a.awaitLoad?M.showMiracle.await.load(a):M.showMiracle.show(a)},await:{load:function(a){var b,c;if("prev"==a.awaitLoad?b=a.$.prev(".miracle"):(c="[data-m-id='"+a.awaitLoad+"']",b=$(c)),b.hasClass("miracle"))var d=setInterval(function(){a.$.data("m-loaded")&&b.data("m-loaded")&&(M.showMiracle.show(a),clearInterval(d))},5);else console.log("MIRACLE ERROR: There is no miracle to await for this miracle:",a),M.showMiracle.show(a)},show:function(a){var b,c;if("prev"==a.awaitShow?b=a.$.prev(".miracle"):(c="[data-m-id='"+a.awaitShow+"']",b=$(c)),b.hasClass("miracle"))var d=setInterval(function(){a.$.data("m-loaded")&&b.data("m-shown")&&(M.showMiracle.show(a),clearInterval(d))},5);else console.log("MIRACLE ERROR: There is no miracle to await for this miracle:",a),M.showMiracle.show(a)}},show:function(a){var b,c;b=a.timeout?a.timeout:0,c=a.spinner?M.settings.spinnerFadeTimeout:0,setTimeout(function(){M.spinner.hide(a),M.vars.miracleStyleElem[0].innerHTML+=M.buildRule.state.init(a),setTimeout(function(){M.vars.miracleStyleElem[0].innerHTML+=M.buildRule.state.final(a),M.markAsShown(a)},c)},b)}},M.buildRule={state:{init:function(a){var b,c,d="";return b=M.buildRule.selector.init(a),c=M.buildRule.declars.init(a),d=b+" { "+c+" }"},"final":function(a){var b,c,d="";return b=M.buildRule.selector.final(a),c=M.buildRule.declars.final(a),d=b+" { "+c+" }"}},selector:{init:function(a){return"[data-m-rule-init='"+a.name+"']"},"final":function(a){return"[data-m-rule-final='"+a.name+"']"}},declars:{init:function(a){var b,c,d,e,f=a.scaleInit,g=a.effect,h=a.style.init;return d=a.opaque?"opacity: 1;":"opacity: 0;",a.translate&&(e=a.translate),"fade-in"==g?b=d:"ease-y"==g?(f?{}:f="0.9",c="-webkit-transform: scaleY("+f+");",b=c+d+" transform: scaleY("+f+");"):"ease-x"==g?(f?{}:f="0.9",c="-webkit-transform: scaleX("+f+");",b=c+d+" transform: scaleY("+f+");"):"from-space"==g?(f?{}:f="3",e?{}:e="-200px, -200px",c="-webkit-transform: scale("+f+") translate("+e+");",b=c+d+" transform: scale("+f+") translate("+e+");"):"from-hell"==g?(f?{}:f="0",e?{}:e="-200px, -200px",c="-webkit-transform: scale("+f+") translate("+e+");",b=c+d+" transform: scale("+f+") translate("+e+");"):"scale"==g?(f?{}:f="0.3",c="-webkit-transform: scale("+f+");",b=c+d+" transform: scale("+f+");"):"slide"==g?(e?{}:e="0px, -200px",c="-webkit-transform: translate("+e+");",b=c+d+" transform: translate("+e+");"):b=h?h:d,b},"final":function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n="",o="",p=a.effect,q=a.style.final,r=a.origin;return b=a.easing?a.easing:M.settings.easing[p]?M.settings.easing[p]:M.settings.easing.default,c=a.duration?a.duration:M.settings.effectDuration,r&&(e="-webkit-transform-origin: "+r+";",d=e+" transform-origin: "+r+";"),k="-webkit-transition-property: opacity, -webkit-transform;",l="-webkit-transition-duration: "+c+"ms;",m="-webkit-transition-timing-function: "+b+";",g=k+l+m,h="transition-property: opacity, transform;",i="transition-duration: "+c+"ms;",j="transition-timing-function: "+b+";",f=h+i+j,"fade-in"==p?n="opacity: 1;"+g+f:"ease-y"==p?(r?{}:d="-webkit-transform-origin: center; transform-origin: center;",o=" -webkit-transform: scaleY(1);",n=o+g+f+d+" opacity: 1; transform: scaleY(1); transform-origin: 50% 0;"):"ease-x"==p?(r?{}:d="-webkit-transform-origin: center; transform-origin: center;",o=" -webkit-transform: scaleX(1);",n=o+g+f+d+" opacity: 1; transform: scaleY(1); transform-origin: 50% 0;"):"from-hell"==p?(r?{}:d="-webkit-transform-origin: center; transform-origin: center;",o=" -webkit-transform: scale(1) translate(0);",n=o+g+f+d+" opacity: 1; transform: scale(1) translate(0);"):"from-space"==p?(r?{}:d="-webkit-transform-origin: center; transform-origin: center;",o=" -webkit-transform: scale(1) translate(0);",n=o+g+f+d+" opacity: 1; transform: scale(1) translate(0);"):"scale"==p?(r?{}:d="-webkit-transform-origin: center; transform-origin: center;",o="-webkit-transform: scale(1);",n=o+g+f+d+" opacity: 1; transform: scale(1);"):"slide"==p?(r?{}:d="-webkit-transform-origin: center; transform-origin: center;",o="-webkit-transform: translate(0);",n=o+g+f+d+" opacity: 1; transform: translate(0);"):n=q?q:"opacity: 1;"+g+f,n}}},M.spinner={show:function(a){"undefined"!=typeof Spinner&&a.spinner.use&&(a.$.css("opacity","1"),a.$.css("visibility","hidden"),a.spinner.this=new Spinner(M.settings.spinnerOpts).spin(),a.spinner.$=$(a.spinner.this.el),a.spinner.$.css({top:"50%",left:"50%",visibility:"visible"}),a.$[0].appendChild(a.spinner.this.el))},hide:function(a){if("undefined"!=typeof Spinner&&a.spinner.use){var b=M.settings.spinnerFadeTimeout;a.$.css("opacity",""),a.$.css("visibility","");var c="opacity "+M.settings.spinnerFadeTimeout+"ms  ease-in-out";a.spinner.$.css({transition:c,opacity:0}),setTimeout(function(){a.spinner.this.stop()},b)}}},M.createStyleElem=function(){var a="miracle-plugin-style",b=$("<style type='text/css'></style>");b.attr("id",a),b.appendTo("head"),M.vars.miracleStyleElem=$(b[0]),M.vars.miracleStyleElem[0].innerHTML=M.settings.miraclesDefaultStyle},M.defineSelectors=function(a){a.$.attr("data-m-rule-init",a.name),a.$.attr("data-m-rule-final",a.name)},M.getUniqueName=function(){return Math.random().toString(36).substr(2,9)},M.markAsShown=function(a){var b;b=a.duration?a.duration:M.settings.effectDuration,setTimeout(function(){a.$.data("m-shown",!0)},b)},M.parseBgImgUrls=function(a){var b,c,d,e,f=[],g=/url\(["']?.*?["']?\)/g;if("none"!=a.css("background-image")&&(b=a.css("background-image"),c=b.match(g)))for(var h=0,i=c.length;i>h;h++)d=c[h],e=d.replace(/^url\(["']?/,"").replace(/["']?\)$/,""),e?f.push(e):{};return f},$(function(){M.init()});